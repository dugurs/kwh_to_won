<html>
<head>

</head>
<body>

  <script>
    // https://cyber.kepco.co.kr/ckepco/front/jsp/CY/J/A/CYJAPP000NFL.jsp#
    function kwh2won(energy) {
      const d = new Date();
      //const month = ((d.getMonth()+1) * 100 ) + d.getDate();
      const month = 1201;
      let checkday = 1; // 검침일
      let basicprice = [910, 1600, 7300]; // 기본요금(원/호)
      let kwhprice = [88.3, 182.9, 275.6]; // 전력량 요금(원/kWh)
      // let kwhprice = [93.3, 187.9, 280.6]; // 전력량 요금(원/kWh) - 개편전 요금
      let kwhsectioUp = [0, 200, 400]; // 구간(kWh - 상계)
      let kwhsectionDown = [0, 300, 450]; // 구간(kWh - 하계)(7~8월)
      let sectionDown = [7,8]; // 하계 기간
      let adjustment = [-5, 5.3, 0]; // 환경비용차감 + 기후환경요금 + 연료비조정액
      let dayUp = 0; // 상계일수
      let dayDown = 0; // 하계일수 (7,8월)
      let wonUp = 0; // 상계 전력량요금
      let wonDown = 0; // 하계 전력량요금
      let progUp = 0; // 누진단계
      let progDown = 0;
      let UsingCharge = 0; // 전력량요금
      let energyUp = energy;
      let energyDown = energy;

      
	    // var amount_difference2 = 0;		//기후환경비용(요금개편차액)
	    // var amount_climate = 0;			//기후환경요금
	    // var amount_fuel = 0;		//연료비조정요금

      // var BasicCharge = 0;	//기본요금 / 원미만 절사
      // var Demand_Qty = 0; //전기요금계 (기본요금 + 전력량 요금)

      let totalAmount = 0; // 최종금액

      adjustment = adjustment[0] + adjustment[1] + adjustment[2];
      const adjustValue = Math.floor(energy * adjustment); // 조정액
      console.log(`energy ${energy}`);
      for (let s=2; s>=0; s--) {
        if (kwhsectioUp[s] < energyUp) { // 상계금액
          console.log(`상계 ${s+1}단계 금액 : ${(energyUp - kwhsectioUp[s]) * kwhprice[s]}won = ${energyUp - kwhsectioUp[s]}kWh * ${kwhprice[s]}won, energyUp: ${energyUp}`);
          wonUp += (energyUp - kwhsectioUp[s]) * kwhprice[s]; // 구간 요금 계산
          energyUp -= energyUp - kwhsectioUp[s]; // 계산된 구간 용량 빼기
          progUp++; // 누진 단계
        }
        if (kwhsectionDown[s] < energyDown) { // 하계금액
          console.log(`하계 ${s+1}단계 금액 : ${(energyDown - kwhsectionDown[s]) * kwhprice[s]}won = ${energyDown - kwhsectionDown[s]}kWh * ${kwhprice[s]}won, energyDown: ${energyDown}`);
          wonDown += (energyDown - kwhsectionDown[s]) * kwhprice[s];
          energyDown -= energyDown - kwhsectionDown[s];
          progDown++;
        }
      }
      console.log(`상계 요금 : ${basicprice[progUp-1]+wonUp}원 = ${progUp}단계, 기본 ${basicprice[progUp-1]}원 + 사용 ${wonUp}원`);
      console.log(`하계 요금 : ${basicprice[progDown-1]+wonDown}원 = ${progDown}단계, 기본 ${basicprice[progDown-1]}원 + 사용 ${wonDown}원`);
      wonUp += basicprice[progUp-1]; // 기본요금 더하기
      wonDown += basicprice[progDown-1];
      
      if (month > checkday + 600 && month <= checkday + 900) { // 하계(7~8월), 상하계 사용 일수 계산
        if (month <= checkday + 700) { // 검침일이 7월일때 
          dayUp = 30 - checkday;
          dayDown = checkday;
        } else if (month <= checkday + 800) { // 검침일이 8월일때 
          dayUp = 0;
          dayDown = 31;
        } else { // 검침일이 9월일때 
          dayUp = checkday;
          dayDown = 31 - checkday;
        }
        console.log(`상계 일수 ${dayUp}일, 일계요금 ${Math.floor(wonUp * dayUp / (dayUp+dayDown))}`);
        console.log(`하계 일수 ${dayDown}일, 일계요금 ${Math.floor(wonDown * dayDown / (dayUp+dayDown))}`);
        UsingCharge = Math.floor(wonUp * dayUp / (dayUp+dayDown)) + Math.floor(wonDown * dayDown / (dayUp+dayDown));
      } else { // 상계
        console.log(`상계 일수 *일, 일계요금 ${wonUp}원`);
        console.log(`하계 일수 0일, 일계요금 0원`);
        UsingCharge = wonUp;
      }


      
      const iBigFamBoolean = 1; // 대가족 요금할인
      const iWelfareDcBoolean = 5; // 복지 요금할인
      
      let dcValue = 0; // 최종 할인요금
      let elecBasicValue = 0; // 필수사용량 보장공제
      let elecBasic200Value = 0; // 200kWh 이하 감액

      // 필수사용량 보장공제
      // [200kWh 이하, 최대 2,000원]
      // (기본요금 ＋ 전력량요금 ＋ 기후환경요금 ± 연료비조정액) - 1000
      const elecBasic = 200;
      if (energy <= elecBasic) {
        elecBasicValue = UsingCharge + adjustValue - 1000;
        if (elecBasicValue > 2000) {
          elecBasicValue = 2000;
        }
        console.log(`필수사용량 보장공제 : ${elecBasicValue}`);
      }


      if (iBigFamBoolean || iWelfareDcBoolean) {
        // 복지할인
        // 필수사용량 보장공제 = 0
        // 200kWh 이하 감액(원미만 절사) = 2,500
        if ((iBigFamBoolean || iWelfareDcBoolean) && energy <= elecBasic) {
          elecBasicValue = 0;
          elecBasic200Value = 4000;
          console.log(`200kWh 이하 감액 : ${elecBasic200Value}`);
        }


        // 복지 요금할인
        // B1 : 독립유공자,국가유공자,5.18민주유공자,장애인 (16,000원 한도)
        // B2 : 사회복지시설 (전기요금계((기본요금 ＋ 전력량요금 ＋ 기후환경요금 ± 연료비조정액) － 필수사용량 보장공제) x 30%, 한도 없음)
        // B3 : 기초생활(생계.의료) (16,000원 한도) + 중복할인
        // B4 : 기초생활(주거.교육) (10,000원 한도) + 중복할인
        // B5 : 차사위계층 (8,000원 한도) + 중복할인
        // B  : 전기요금계(기본요금 ＋ 전력량요금 ＋ 기후환경요금 ± 연료비조정액 － 200kWh이하감액 － 복지할인)
        // B2 :              전기요금계(기본요금 ＋ 전력량요금 ＋ 기후환경요금 ± 연료비조정액 － 200kWh이하감액 － 복지할인 － 필수사용량 보장공제)
        let iWelfareDcValue = 0;
        if (iWelfareDcBoolean) {
          iWelfareDcValue = Math.floor(UsingCharge + adjustValue);
          if (iWelfareDcBoolean == 1) { // B1
            iWelfareDcValue = (iWelfareDcValue < 16000) ? iWelfareDcValue : 16000;
            console.log(`유공자,장애인 : ${iWelfareDcValue} = (전기요금계 - 200kWh이하감액 ) or 16,000`);
          } else if (iWelfareDcBoolean == 2) {
            iWelfareDcValue = Math.floor((UsingCharge + adjustValue) * 0.3);
            console.log(`사회복지시설 : ${iWelfareDcValue} = (전기요금계 - 필수사용량 보장공제 ) x 30%, 한도 없음`);
          } else if (iWelfareDcBoolean == 3) {
            iWelfareDcValue = (iWelfareDcValue < 16000) ? iWelfareDcValue : 16000;
            console.log(`기초생활(생계.의료) : ${iWelfareDcValue} = (전기요금계 - 200kWh이하감액 ) or 16,000`);
          } else if (iWelfareDcBoolean == 4) {
            iWelfareDcValue = (iWelfareDcValue < 10000) ? iWelfareDcValue : 10000;
            console.log(`기초생활(주거.교육) : ${iWelfareDcValue} = (전기요금계 - 200kWh이하감액 ) or 10,000`);
          } else if (iWelfareDcBoolean == 5) {
            iWelfareDcValue = (iWelfareDcValue < 8000) ? iWelfareDcValue : 8000;
            console.log(`차사위계층 : ${iWelfareDcValue} = (전기요금계 - 200kWh이하감액 ) or 8,000`);
          }
        }

        // 대가족 요금할인
        // A1 : 5인이상 가구,출산가구,3자녀이상 가구 (16,000원 한도)
        // A2 : 생명유지장치 (한도 없음)
        // 전기요금계((기본요금 ＋ 전력량요금 － 필수사용량 보장공제 ＋ 기후환경요금 ± 연료비조정액) － 200kWh이하감액) x 30% = 대가족 요금할인
        
        let iBigFamValue = 0;
        if (iBigFamBoolean) {
          let iWelfareDcValue_temp = (iWelfareDcBoolean >= 3) ? iWelfareDcValue : 0;
          iBigFamValue = Math.floor((UsingCharge + adjustValue - elecBasic200Value - iWelfareDcValue_temp) * 0.3);
          if (iBigFamBoolean == 1) { // A1
            iBigFamValue = (iBigFamValue < 16000) ? iBigFamValue : 16000;
            console.log(`대가족 요금할인 : ${iBigFamValue} = 전기요금계 - ${elecBasic200Value} - ${iWelfareDcValue_temp} x30%, 최대 16000`);
          } else {
            console.log(`생명유지장치 : ${iBigFamValue} = 전기요금계 - ${elecBasic200Value} - ${iWelfareDcValue_temp} x30%`);
          }
        }

        // A B 중 큰 금액 적용
        // 차사위계층,기초생활은 A + B
        if (iWelfareDcBoolean >= 3) {
          dcValue = iBigFamValue + iWelfareDcValue
          console.log(`복지할인 ${dcValue} = 대가족 요금할인 ${iBigFamValue} + 복지 요금할인 ${iWelfareDcValue}`)
        } else {
          dcValue = (iBigFamValue > iWelfareDcValue) ? iBigFamValue : iWelfareDcValue ;
          console.log(`복지할인 ${dcValue} = 대가족 요금할인 ${iBigFamValue} or 복지 요금할인 ${iWelfareDcValue} 더큰것`)
        }
      }


      console.log(`최종 요금 : ${parseInt((UsingCharge + adjustValue - elecBasicValue - elecBasic200Value - dcValue) * 1.137)}원 = ((사용요금 ${UsingCharge} + (조정액 ${adjustValue}) - 필수사용량 보장공제${elecBasicValue} - 200kWh 이하 감액${elecBasic200Value} - 복지할인 ${dcValue}) * 부가세,기금1.137)`);
      totalAmount =  Math.floor(((UsingCharge + adjustValue - elecBasicValue - elecBasic200Value - dcValue) * 1.137)/10)*10;
      return (totalAmount > 0) ? totalAmount : 0;
    }
    
    console.log(kwh2won(201));
    </script>

</body>
</html>